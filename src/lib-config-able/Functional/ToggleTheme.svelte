<script lang='ts'>
  import { onMount } from 'svelte'
  import { getConfig, rounded } from '../utility'
  import { Button } from '../index'

  let toggleTheme
  onMount((): void => {
    if(getConfig('toggleTheme') === true){
      toggleTheme = () => {
        localStorage.setItem('theme', localStorage.theme == 'light' ? 'dark' : 'light')
        document.querySelector('html').classList.remove('dark', 'light')
        document.querySelector('html').classList.add(localStorage.theme)
      }
    }
  })
</script>

<svelte:head>
{#if getConfig('toggleTheme') === true}
  <script>
    function setTheme() {
      if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
        document.documentElement.classList.add('dark')
      } else {
        document.documentElement.classList.remove('dark')
      }
    }
    setTheme();
  </script>
  {/if}

  {#if getConfig('toggleTheme') === 'system'}
  <script>
    function setTheme() {
      if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.documentElement.classList.add('dark')
      } else {
        document.documentElement.classList.remove('dark')
      }
    }
    setTheme();
  </script>
  {/if}
</svelte:head>

{#if getConfig('toggleTheme') === true}
<button class={($$props.class||'bg-transparent p-0.5') + rounded(getConfig('isRounded'))} on:click={()=>toggleTheme()} attr={{ 'aria-label' : 'Toggle light or dark mode' }}>
  <slot name='icon'>
    <svg xmlns='http://www.w3.org/2000/svg' fill='currentColor' viewBox='0 0 16 16' class='w-4 h-4'>
      <path d='M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z'/>
    </svg>
  </slot>
</button>
{/if}